#include "ap_int.h"
//#include "ap_fixed.h"

#define SIZE = 128;
 struct axis_fixed{
     ap_int<32> data;
     ap_uint<1> last;
   };

	static ap_fixed<16,11> preamble[128] = {0.00554,
			0.00536,
			0.00452,
			0.00306,
			0.00112,
			-0.0011,
			-0.00337,
			-0.00541,
			-0.00697,
			-0.00783,
			-0.00783,
			-0.00693,
			-0.00516,
			-0.00268,
			0.000277,
			0.00337,
			0.00623,
			0.00848,
			0.00978,
			0.00988,
			0.00863,
			0.00606,
			0.00232,
			-0.00227,
			-0.00726,
			-0.0121,
			-0.0162,
			-0.019,
			-0.02,
			-0.019,
			-0.0158,
			-0.0106,
			-0.00377,
			0.00399,
			0.0118,
			0.0187,
			0.0237,
			0.0257,
			0.0239,
			0.0178,
			0.0073,
			-0.00723,
			-0.0249,
			-0.0445,
			-0.0639,
			-0.081,
			-0.0934,
			-0.0983,
			-0.0934,
			-0.0764,
			-0.0457,
			-0.000226,
			0.0602,
			0.135,
			0.222,
			0.32,
			0.424,
			0.531,
			0.637,
			0.736,
			0.825,
			0.898,
			0.954,
			0.988,
			1,
			0.988,
			0.954,
			0.898,
			0.825,
			0.736,
			0.637,
			0.531,
			0.424,
			0.32,
			0.222,
			0.135,
			0.0602,
			-0.000226,
			-0.0457,
			-0.0764,
			-0.0934,
			-0.0983,
			-0.0934,
			-0.081,
			-0.0639,
			-0.0445,
			-0.0249,
			-0.00723,
			0.0073,
			0.0178,
			0.0239,
			0.0257,
			0.0237,
			0.0187,
			0.0118,
			0.00399,
			-0.00377,
			-0.0106,
			-0.0158,
			-0.019,
			-0.02,
			-0.019,
			-0.0162,
			-0.0121,
			-0.00726,
			-0.00227,
			0.00232,
			0.00606,
			0.00863,
			0.00988,
			0.00978,
			0.00848,
			0.00623,
			0.00337,
			0.000277,
			-0.00268,
			-0.00516,
			-0.00693,
			-0.00783,
			-0.00783,
			-0.00697,
			-0.00541,
			-0.00337,
			-0.0011,
			0.00112,
			0.00306,
			0.00452,
			0.00536
};



void matchFilter(axis_fixed *in, axis_fixed *out);

class matchFilter_ff
{
public:
	axis_fixed convol(axis_fixed in[128]){
		axis_fixed out;
		ap_fixed<16,11> tempI;
		ap_fixed<16,11> tempQ;
		out.last =in[0].last;
		tempI = 0.0;
		tempQ = 0.0;
		ap_fixed<16,11> inI;
		ap_fixed<16,11> inQ;
		for(int b = 0; b<128; b++){
			inI.V = (in[b].data.range(31,16));
			inQ.V = (in[b].data.range(15,0));
			tempI = tempI + (inI*preamble[b]);
			tempQ = tempQ + (inQ*preamble[b]);
		}
		out.data.range(31,16)=tempI.V;
		out.data.range(15,0)=tempQ.V;
		return out;
	}

};
